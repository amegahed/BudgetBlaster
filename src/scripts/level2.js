function isDefined(variable){return eval("(typeof("+variable+') != "undefined");')}function isType(a,c){if(a==null||a==undefined){return false}if(!isArray(a)){if(isArray(c)){return false}else{if(c=="boolean"){return typeof(a)=="boolean"}else{if(c=="number"){return typeof(a)=="number"}else{if(c=="string"){return typeof(a)=="string"}else{if(c=="function"){return typeof(a)=="function"}else{if(c=="object"){return typeof(a)=="object"}else{return a instanceof c}}}}}}}else{if(isArray(c)){if(c.length==1){for(var b=0;b<a.length;b++){if(!isType(a[b],c[0])){return false}}return true}else{for(var b=0;b<a.length;b++){if(!isType(a[b],c[b])){return false}}return true}}else{return false}}}function typeToString(a){if(isArray(a)){return"["+function(b){var c="";for(i=0;i<b.length;i++){if(i>0){c+=", "}c+=typeToString(b[i]);return c}}(a)+"]"}else{if(typeof a=="string"){return a}else{return a.name}}}function argumentsType(a,c,d){if(d==undefined){d=c.length}for(var b=0;b<c.length;b++){if(b<d){if(!isType(a[b],c[b])){argumentsType.error="type mismatch on parameter #"+(b+1)+" expected "+typeToString(c[b]);return false}}else{if(!isType(a[b],c[b])&&a[b]!=undefined){argumentsType.error="type mismatch on optional parameter #"+(b+1)+" expected "+typeToString(c[b]);return false}}}return true}function getClosure(d,a,c){function b(){d[a](c)}return b}var verbose=false;function AssertException(a){this.message=a}AssertException.prototype.toString=function(){return"AssertException: "+this.message};function assert(b,a){if(!b){if(verbose){alert("Assertion failed: "+a)}else{throw new AssertException(a)}}}function isString(a){if(typeof(a)=="string"){return true}else{if(typeof arguments[0]=="object"){return(arguments[0].constructor.toString().match(/string/i)!=null)}}}function toLower(a){a=a.replace(/A/g,"a");a=a.replace(/B/g,"b");a=a.replace(/C/g,"c");a=a.replace(/D/g,"d");a=a.replace(/E/g,"e");a=a.replace(/F/g,"f");a=a.replace(/G/g,"g");a=a.replace(/H/g,"h");a=a.replace(/I/g,"i");a=a.replace(/J/g,"j");a=a.replace(/K/g,"k");a=a.replace(/L/g,"l");a=a.replace(/M/g,"m");a=a.replace(/N/g,"n");a=a.replace(/O/g,"o");a=a.replace(/P/g,"p");a=a.replace(/Q/g,"q");a=a.replace(/R/g,"r");a=a.replace(/S/g,"s");a=a.replace(/T/g,"t");a=a.replace(/U/g,"u");a=a.replace(/V/g,"v");a=a.replace(/W/g,"w");a=a.replace(/X/g,"x");a=a.replace(/Y/g,"y");a=a.replace(/Z/g,"z");return a}function toUpper(a){a=a.replace(/a/g,"A");a=a.replace(/b/g,"B");a=a.replace(/c/g,"C");a=a.replace(/d/g,"D");a=a.replace(/e/g,"E");a=a.replace(/f/g,"F");a=a.replace(/g/g,"G");a=a.replace(/h/g,"H");a=a.replace(/i/g,"I");a=a.replace(/j/g,"J");a=a.replace(/k/g,"K");a=a.replace(/l/g,"L");a=a.replace(/m/g,"M");a=a.replace(/n/g,"N");a=a.replace(/o/g,"O");a=a.replace(/p/g,"P");a=a.replace(/q/g,"Q");a=a.replace(/r/g,"R");a=a.replace(/s/g,"S");a=a.replace(/t/g,"T");a=a.replace(/u/g,"U");a=a.replace(/v/g,"V");a=a.replace(/w/g,"W");a=a.replace(/x/g,"X");a=a.replace(/y/g,"Y");a=a.replace(/z/g,"Z");return a}function getQuotatedString(a){if(a&&(a.search('"')==-1)){return'"'+a+'"'}else{return"'"+a+"'"}}function stringToMessage(a){a=a.replace(/ /g,"%20");a=a.replace(/"/g,"%22");a=a.replace(/'/g,"%27");a=a.replace(/;/g,"%3B");return a}function isVowel(a){return(a=="a"||a=="e"||a=="i"||a=="o"||a=="u")}function isArray(a){if(a&&typeof(a)=="object"){return(a.constructor==Array)}else{return false}}function inArray(b,c){for(var a=0;a<c.length;a++){if(c[a]==b){return true}}return false}function getArrayIndex(b,c){for(var a=0;a<c.length;a++){if(c[a]==b){return a}}}function arrayToString(f,c,e,d){var a="";if(e==undefined){e=false}if(c==undefined){c=""}if(d==undefined){d=false}if(d){a+="["}for(var b=0;b<f.length;b++){if(b>0){a+=c}if(isString(f[b])&&e){a+=getQuotatedString(f[b])}else{if(isArray(f[b])){a+=arrayToString(f[b],c,e,d)}else{a+=f[b]}}}if(d){a+="]"}return a}function addEvent(a,c,b){if(a.addEventListener){a.addEventListener(c,b,false);return true}else{if(a.attachEvent){return a.attachEvent("on"+c,b)}else{return false}}}function disableSelection(a){if(typeof a.onselectstart!="undefined"){a.onselectstart=function(){return false}}else{if(typeof a.style.MozUserSelect!="undefined"){a.style.MozUserSelect="none"}else{a.onmousedown=function(){return false}}}a.style.cursor="default"}function disableDragging(a){a.draggable=false;a.onmousedown=function(b){if(b&&b.preventDefault){b.preventDefault()}return false};a.ondragstart=function(b){return false}}function getWindowLeft(a){var b=0;if(a.offsetParent){do{b+=a.offsetLeft}while(a=a.offsetParent)}return b}function getWindowTop(a){var b=0;if(a.offsetParent){do{b+=a.offsetTop}while(a=a.offsetParent)}return b}function getElementById(e,c){if(!c){return document.getElementById(e)}if(typeof(c)=="string"){var a=document.getElementById(c)}else{var a=c}if(a.id==e){return a}var d=a.firstChild;while(d){if(d.id==e){return d}else{var b=getElementById(e,d);if(b){return b}}d=d.nextSibling}return undefined}function getElementAttribute(c,a){var f=c.outerHTML.substring(1,c.outerHTML.length-1);var d=f.split(" ");for(var b=0;b<d.length;b++){var e=d[b].split("=");if(e[0]==a){return e[1]}}}function isElementLoaded(a){if(a.offsetWidth>0&&a.offsetHeight>0){return true}else{if(a.width>0&&a.height>0){return true}else{return false}}}function swapImage(b,c){var a=c.substring(c.length-3,c.length);if(((a=="png")||(a=="PNG"))&&(typeof(swapPNG)!="undefined")){swapPNG(b,c)}else{b.src=c}}function getImageSrc(a){if(a.src){return a.src}else{return a.filters(0).src}}function getWindowWidth(){if(document.body.offsetWidth){return document.body.offsetWidth}else{return window.innerWidth}}function getWindowHeight(){if(document.body.offsetHeight){return document.body.offsetHeight}else{return window.innerHeight}}function setStatus(a){window.status=a}function clearStatus(){window.status=""}function setWindowLocation(a){window.top.location.href=a}function getWindowLocation(){return window.top.location.href}function getBaseLocation(b){var a=b.split("?");return a[0]}function openDialogBox(g,d,a){var f=(screen.width-d)/2;var e=(screen.height-a)/2;var c="resizeable=no, status=no, toolbar=no, menubar=no, location=no, scrollbars=no, directories=no, dialog=yes";var b=window.open(g,"_blank","width="+d+", height="+a+", top="+e+", left="+f+", "+c);if(window.focus&&b){b.focus()}return b}function getCSSStyle(a){for(i=0;i<document.styleSheets.length;i++){if(document.styleSheets[i].rules){for(j=0;j<document.styleSheets[i].rules.length;j++){if(document.styleSheets[i].rules[j].selectorSprite==a){return document.styleSheets[i].rules[j].style}}}else{for(j=0;j<document.styleSheets[i].cssRules.length;j++){if(document.styleSheets[i].cssRules[j].selectorSprite==a){return document.styleSheets[i].cssRules[j].style}}}}}var chars=new Array(" ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","","Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," ");function charToByte(b){for(var a=0;a<chars.length;a++){if(b==chars[a]){return a+32}}return 0}function byteToChar(a){if(a<32||a>255){return" "}return chars[a-32]}function stringToUpper(a){if(a!=null){a=(a.charAt(0)).toUpperCase()+a.substring(1,a.length)}return a}function stringToLower(a){if(a!=null){a=(a.charAt(0)).toLowerCase()+a.substring(1,a.length)}return a}function random(a,b){return a+(b-a)*Math.random()}function sign(a){if(a<0){return -1}else{if(a>0){return 1}else{return 0}}}function createCookie(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path=/"}function readCookie(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null}function eraseCookie(a){createCookie(a,"",-1)}function Component(a,b){if(!a){return this}if(typeof(a)=="string"){if(b){if(b.element){this.element=getElementById(a,b.element)}else{this.element=getElementById(a,b)}}else{this.element=document.getElementById(a)}}else{this.element=a}if(b&&b.addComponent){b.addComponent(this)}this.visible=(this.element!=undefined)&&(this.element.style.display!="none");this.width=this.getWidth();this.height=this.getHeight();return this}Component.prototype.getTop=function(){var a=this;while(a.parent){a=a.parent}return a};Component.prototype.getWidth=function(){if(this.element){if(this.element.offsetWidth!=0){return this.element.offsetWidth}else{if(this.element.width){return this.element.width}else{return this.element.getAttribute("width")}}}else{return 0}};Component.prototype.getHeight=function(){if(this.element){if(this.element.offsetHeight!=0){return this.element.offsetHeight}else{if(this.element.height){return this.element.height}else{return this.element.getAttribute("height")}}}else{return 0}};Component.prototype.getLeft=function(){var b=0;var a=this.element;if(a.offsetParent){do{b+=a.offsetLeft}while(a=a.offsetParent);return b}};Component.prototype.getTop=function(){var b=0;var a=this.element;if(a.offsetParent){do{b+=a.offsetTop}while(a=a.offsetParent);return b}};Component.prototype.setElement=function(a){if(this.element.parentNode){this.element.parentNode.replaceChild(a,this.element)}this.element=a};Component.prototype.setVisible=function(a){this.visible=a;if(this.element){if(a){this.element.style.display="block"}else{this.element.style.display="none"}}};Component.prototype.isVisible=function(){return this.visible&&(!this.parent||!this.parent.isVisible||this.parent.isVisible())};Component.prototype.toggleVisible=function(){this.setVisible(!this.isVisible())};function RGBColor(c,b,a){if(isNaN(c)){c=0}if(isNaN(b)){b=0}if(isNaN(a)){a=0}this.red=c;this.green=b;this.blue=a;return this}RGBColor.prototype.matches=function(a){if(a){return((this.red==a.red)&&(this.green==a.green)&&(this.blue==a.blue))}else{return false}};RGBColor.prototype.duplicate=function(){return new RGBColor(this.red,this.green,this.blue)};RGBColor.prototype.toString=function(a){if(!a){a=", "}return this.red+a+this.green+a+this.blue};RGBColor.prototype.toHex=function(){var c=Math.floor(this.red);var b=Math.floor(this.green);var a=Math.floor(this.blue);if(c<0||isNaN(c)){c=0}if(c>255){c=255}if(b<0||isNaN(b)){b=0}if(b>255){b=255}if(a<0||isNaN(a)){a=0}if(a>255){a=255}c=c.toString(16);b=b.toString(16);a=a.toString(16);if(c.length<2){c="0"+c}if(b.length<2){b="0"+b}if(a.length<2){a="0"+a}return c+b+a};function Vector2(a,b){this.x=a;this.y=b;return this}Vector2.prototype.equals=function(a){if(a){return((this.x==a.x)&&(this.y==a.y))}else{return false}};Vector2.prototype.clone=function(){return new Vector2(this.x,this.y)};Vector2.prototype.toString=function(b,a){if(!b){b=Vector2.separator}if(!a){a=Vector2.precision}return this.x.toPrecision(a)+b+this.y.toPrecision(a)};Vector2.prototype.add=function(a){this.x=this.x+a.x;this.y=this.y+a.y};Vector2.prototype.subtract=function(a){this.x=this.x-a.x;this.y=this.y-a.y};Vector2.prototype.multiplyBy=function(a){this.x=this.x*a.x;this.y=this.y*a.y};Vector2.prototype.divideBy=function(a){this.x=this.x/a.x;this.y=this.y/a.y};Vector2.prototype.scaleBy=function(a){this.x=this.x*a;this.y=this.y*a};Vector2.prototype.normalize=function(){this.scaleBy(1/this.length())};Vector2.prototype.plus=function(b){var a=this.x+b.x;var c=this.y+b.y;return new Vector2(a,c)};Vector2.prototype.minus=function(b){var a=this.x-b.x;var c=this.y-b.y;return new Vector2(a,c)};Vector2.prototype.times=function(b){var a=this.x*b.x;var c=this.y*b.y;return new Vector2(a,c)};Vector2.prototype.dividedBy=function(b){var a=this.x/b.x;var c=this.y/b.y;return new Vector2(a,c)};Vector2.prototype.scaledBy=function(b){var a=this.x*b;var c=this.y*b;return new Vector2(a,c)};Vector2.prototype.normalized=function(){return this.scaledBy(1/this.length())};Vector2.prototype.dot=function(a){return(this.x*a.x)+(this.y*a.y)};Vector2.prototype.length=function(){return Math.sqrt(this.dot(this))};Vector2.prototype.rotateBy=function(b){var a=this.x*Math.cos(b*Math.PI/180)-this.y*Math.sin(b*Math.PI/180);var c=this.x*Math.sin(b*Math.PI/180)+this.y*Math.cos(b*Math.PI/180);this.x=a;this.y=c};Vector2.prototype.rotatedBy=function(b){var a=this.x*Math.cos(b*Math.PI/180)-this.y*Math.sin(b*Math.PI/180);var c=this.x*Math.sin(b*Math.PI/180)+this.y*Math.cos(b*Math.PI/180);return new Vector2(a,c)};Vector2.prototype.toVector3=function(a){if(a==undefined){a=0}return new Vector3(this.x,this.y,a)};Vector2.precision=3;Vector2.separator=", ";function Vector3(a,c,b){this.x=a;this.y=c;this.z=b;return this}Vector3.prototype.equals=function(a){if(a){return((this.x==a.x)&&(this.y==a.y)&&(this.z==a.z))}else{return false}};Vector3.prototype.clone=function(){return new Vector3(this.x,this.y,this.z)};Vector3.prototype.toString=function(b,a){if(!b){b=Vector3.separator}if(!a){a=Vector3.precision}return this.x.toPrecision(a)+b+this.y.toPrecision(a)+b+this.z.toPrecision(a)};Vector3.prototype.toArray=function(){return[this.x,this.y,this.z]};Vector3.prototype.add=function(a){this.x=this.x+a.x;this.y=this.y+a.y;this.z=this.z+a.z};Vector3.prototype.subtract=function(a){this.x=this.x-a.x;this.y=this.y-a.y;this.z=this.z-a.z};Vector3.prototype.multiplyBy=function(a){this.x=this.x*a.x;this.y=this.y*a.y;this.z=this.z*a.z};Vector3.prototype.divideBy=function(a){this.x=this.x/a.x;this.y=this.y/a.y;this.z=this.z/a.z};Vector3.prototype.scaleBy=function(a){this.x=this.x*a;this.y=this.y*a;this.z=this.z*a};Vector3.prototype.normalize=function(){this.scaleBy(1/this.length())};Vector3.prototype.plus=function(b){var a=this.x+b.x;var d=this.y+b.y;var c=this.z+b.z;return new Vector3(a,d,c)};Vector3.prototype.minus=function(b){var a=this.x-b.x;var d=this.y-b.y;var c=this.z-b.z;return new Vector3(a,d,c)};Vector3.prototype.times=function(b){var a=this.x*b.x;var d=this.y*b.y;var c=this.z*b.z;return new Vector3(a,d,c)};Vector3.prototype.dividedBy=function(b){var a=this.x/b.x;var d=this.y/b.y;var c=this.z/b.z;return new Vector3(a,d,c)};Vector3.prototype.scaledBy=function(b){var a=this.x*b;var d=this.y*b;var c=this.z*b;return new Vector3(a,d,c)};Vector3.prototype.normalized=function(){return this.scaledBy(1/this.length())};Vector3.prototype.dot=function(a){return(this.x*a.x)+(this.y*a.y)+(this.z*a.z)};Vector3.prototype.cross=function(b){var a=(this.y*b.z)-(this.z*b.y);var d=(this.z*b.x)-(this.x*b.z);var c=(this.x*b.y)-(this.y*b.x);return new Vector3(a,d,c)};Vector3.prototype.parallel=function(a){var b=a.dot(a);if(b!=0){return a.scaledBy(this.dot(a)/b)}else{return this}};Vector3.prototype.perpendicular=function(a){return this.minus(this.parallel(a))};Vector3.prototype.length=function(){return Math.sqrt(this.dot(this))};Vector3.prototype.rotateBy=function(f,e){var c=e.length();if(c!=0){var b=this.perpendicular(e);var a=(e.cross(b)).scaledBy(1/c);var m=this.parallel(e);var l=Math.cos(f*Math.PI/180);var h=Math.sin(f*Math.PI/180);var g=b.scaledBy(l);var k=a.scaledBy(h);var d=(g.plus(k)).plus(m);this.x=d.x;this.y=d.y;this.z=d.z}};Vector3.prototype.rotatedBy=function(e,d){var c=d.length();if(c!=0){var b=this.perpendicular(d);var a=(d.cross(b)).scaledBy(1/c);var l=this.parallel(d);var k=Math.cos(e*Math.PI/180);var g=Math.sin(e*Math.PI/180);var f=b.scaledBy(k);var h=a.scaledBy(g);return(f.plus(h)).plus(l)}else{return this}};Vector3.prototype.toVector2=function(){return new Vector2(this.x,this.y)};Vector3.precision=3;Vector3.separator=", ";function Extents2(a,b){this.set(a,b);return this}Extents2.prototype.setLocation=function(a){this.set(a,this.size)};Extents2.prototype.setSize=function(a){this.set(this.location,a)};Extents2.prototype.set=function(a,b){this.location=a;this.size=b;if(this.size){this.xmin=this.location.x-this.size.x/2;this.xmax=this.location.x+this.size.x/2;this.ymin=this.location.y-this.size.y/2;this.ymax=this.location.y+this.size.y/2}else{this.xmin=this.location.x;this.xmax=this.location.x;this.ymin=this.location.y;this.ymax=this.location.y}};Extents2.prototype.contains=function(a){return(a.x>=this.xmin)&&(a.x<=this.xmax)&&(a.y>=this.ymin)&&(a.y<=this.ymax)};Extents2.prototype.overlaps=function(a){if(this.xmin>a.xmax){return false}else{if(this.xmax<a.xmin){return false}else{if(this.ymin>a.ymax){return false}else{if(this.ymax<a.ymin){return false}else{return true}}}}};Extents2.prototype.getUpperLeft=function(){return new Vector2(this.xmin,this.ymax)};Extents2.prototype.getUpperRight=function(){return new Vector2(this.xmax,this.ymax)};Extents2.prototype.getLowerLeft=function(){return new Vector2(this.xmin,this.ymin)};Extents2.prototype.getLowerRight=function(){return new Vector2(this.xmin,this.ymin)};function Extents3(a,b){this.set(a,b);return this}Extents3.prototype.setLocation=function(a){this.set(a,this.size)};Extents3.prototype.setSize=function(a){this.set(this.location,a)};Extents3.prototype.set=function(a,b){this.location=a;this.size=b;this.xmin=this.location.x-this.size.x/2;this.xmax=this.location.x+this.size.x/2;this.ymin=this.location.y-this.size.y/2;this.ymax=this.location.y+this.size.y/2;this.zmin=this.location.z-this.size.z/2;this.zmax=this.location.z+this.size.z/2};Extents3.prototype.contains=function(a){return this.xmin<=a.x&&a.x<=this.xmax&&this.ymin<=a.y&&a.y<=this.ymax&&this.zmin<=a.z&&a.z<=this.zmax};Extents3.prototype.overlaps=function(a){if(this.xmin>a.xmax){return false}else{if(this.xmax<a.xmin){return false}else{if(this.ymin>a.ymax){return false}else{if(this.ymax<a.ymin){return false}else{if(this.zmin>a.zmax){return false}else{if(this.zmax<a.zmin){return false}else{return true}}}}}}};function Canvas(b,c){if(arguments.length==0){return}Component.call(this,b,c);this.width=this.element.clientWidth;this.height=this.element.clientHeight;this.left=getWindowLeft(this.element);this.top=getWindowTop(this.element);this.origin=new Vector2(this.width/2,this.height/2);var a=this;window.onresize=function(){a.onResize()};return this}Canvas.prototype=new Component();Canvas.prototype.setColor=function(a){this.element.style.background=a};Canvas.prototype.load=function(b){if(!b){return}if(isArray(b)){for(var a=0;a<b.length;a++){if(b[a]&&b[a].onLoad){b[a].onLoad(this)}}}else{if(b.onLoad){b.onLoad(this)}}};Canvas.prototype.unload=function(b){if(isArray(b)){for(var a=0;a<b.length;a++){if(b[a]&&b[a].onLoad){b[a].onUnload(this)}}}else{if(b.onUnload){b.onUnload(this)}}};Canvas.prototype.toScreenCoords=function(b){var a=(b.x/this.width)*2-1;var c=(b.y/this.height)*-2+1;return new Vector2(a,c)};Canvas.prototype.toString=function(){return"canvas"};Canvas.prototype.onResize=function(){this.width=this.element.clientWidth;this.height=this.element.clientHeight;this.left=getWindowLeft(this.element);this.top=getWindowTop(this.element);this.origin=new Vector2(this.width/2,this.height/2)};function Icon(d,b,e,c){if(b==undefined){b="center"}if(e==undefined){e="middle"}if(c==undefined){c=new Vector2(0,0)}if(typeof d=="string"){this.image=new Image()}else{this.image=d}this.hAlign=b;this.vAlign=e;this.anchor=c;this.origin=new Vector2(0,0);var a=this;this.image.onload=function(){a.onLoad()};if(typeof d=="string"){this.image.src=d}return this}Icon.prototype.toString=function(){return"Icon"};Icon.prototype.onLoad=function(){if(this.hAlign=="left"){this.origin.x=0}else{if(this.hAlign=="center"){this.origin.x=this.image.width/2}else{if(this.hAlign=="right"){this.origin.x=this.image.width}}}if(this.vAlign=="top"){this.origin.y=0}else{if(this.vAlign=="middle"){this.origin.y=this.image.height/2}else{if(this.vAlign=="bottom"){this.origin.y=this.image.height}}}if(this.onload){this.onload()}};function Element(a){if(arguments.length==0){return}if(a==undefined){a=new Vector2(0,0)}this.location=a.clone();this.canvas=null;return this}Element.prototype.isLoaded=function(){return(this.canvas!=null)};Element.prototype.setLocation=function(a){this.location=a};Element.prototype.hide=function(){if(this.element){this.element.style.display="none"}};Element.prototype.show=function(){if(this.element){this.element.style.display="block"}};Element.prototype.toString=function(){return"Element"};Element.prototype.onLoad=function(a){if(this.canvas){return}this.canvas=a;this.loaded=true};function Sprite(b,a,c){if(arguments.length==0){return}if(a==undefined){a=new Vector2(0,0)}if(c==undefined){c=1}Element.call(this,a);this.icon=b;this.scale=c;return this}Sprite.prototype=new Element();Sprite.prototype.setIcon=function(a){this.icon=a;if(this.canvas){this.image.src=a.image.src;this.onResize()}};Sprite.prototype.setLocation=function(a){this.location=a;if(this.canvas){this.left=(this.canvas.origin.x)+a.x*(this.canvas.origin.x)-(this.icon.origin.x+this.icon.anchor.x)*this.scale;this.top=(this.canvas.origin.y)-a.y*(this.canvas.origin.y)-(this.icon.origin.y+this.icon.anchor.y)*this.scale;this.image.style.left=this.left;this.image.style.top=this.top;if(a.z!=undefined){this.image.style.zIndex=a.z}}};Sprite.prototype.showBorder=function(a,b){if(a==undefined){a="white"}if(b==undefined){b=2}this.image.style.border=b+"px solid "+a};Sprite.prototype.hideBorder=function(){this.image.style.border="none"};Sprite.prototype.getSize=function(){return this.size};Sprite.prototype.isVisible=function(){return AnimatedSprite.screenExtents.overlaps(this.getExtents())};Sprite.prototype.getExtents=function(){if(this.extents){return this.extents}else{if(this.image&&this.image.loaded){return new Extents2(this.location,this.getSize())}else{return null}}};Sprite.prototype.toString=function(){return"Sprite"};Sprite.prototype.onLoad=function(b){Element.prototype.onLoad.call(this,b);this.image=new Image();this.image.style.position="absolute";disableSelection(this.image);disableDragging(this.image);this.canvas=b;var a=this;this.image.onload=function(){a.onResize();if(!a.image.loaded){b.element.appendChild(a.image)}a.image.loaded=true};this.image.src=this.icon.image.src};Sprite.prototype.onUnload=function(){if(this.canvas){this.canvas.element.removeChild(this.image);this.canvas=null}};Sprite.prototype.onResize=function(){this.width=this.icon.image.width*this.scale;this.height=this.icon.image.height*this.scale;this.image.style.width=this.width+"px";this.image.style.height=this.height+"px";if(this.canvas){this.size=new Vector2(this.width/this.canvas.width,this.height/this.canvas.height)}this.setLocation(this.location)};function AnimatedSprite(c,b,g,e,h,d,a,f){if(arguments[0]==null){return}if(g==undefined){g=1}if(e==undefined){e=new Vector2(0,0)}Sprite.call(this,c,b,g);this.velocity=e;this.hWrap=h;this.vWrap=d;this.hBounce=a;this.vBounce=f;return this}AnimatedSprite.prototype=new Sprite();AnimatedSprite.prototype.setLocation=function(a){if(this.hWrap){if(a.x<-1){a.x=1}else{if(a.x>1){a.x=-1}}}else{if(this.hBounce){if(a.x<-1){a.x=-1;this.velocity.x=-this.velocity.x}else{if(a.x>1){a.x=1;this.velocity.x=-this.velocity.x}}}}if(this.vWrap){if(a.y<-1){a.y=1}else{if(a.y>1){a.y=-1}}}else{if(this.vBounce){if(a.y<-1){a.y=-1;this.velocity.y=-this.velocity.y}else{if(a.y>1){a.y=1;this.velocity.y=-this.velocity.y}}}}Sprite.prototype.setLocation.call(this,a);this.extents=null};AnimatedSprite.prototype.update=function(a){this.setLocation(this.location.plus(this.velocity.scaledBy(a/1000).toVector3(0)))};AnimatedSprite.prototype.start=function(a){if(a==undefined){a=30}this.intervalTime=a;var b=this;this.interval=window.setInterval(function(){b.update(b.intervalTime)},this.intervalTime)};AnimatedSprite.prototype.finish=function(){window.clearInterval(this.interval)};AnimatedSprite.prototype.onLoad=function(a){if(this.canvas){return}Sprite.prototype.onLoad.call(this,a);if(this.showingBounds){this.canvas.load(this.boundingBox)}};AnimatedSprite.prototype.onUnload=function(){if(this.showingBounds){this.applet.removeOverlay(this.boundingBox)}Sprite.prototype.onUnload.call(this)};AnimatedSprite.screenExtents=new Extents2(new Vector2(0,0),new Vector2(2,2));function Rect(a,d,b,c){if(b==undefined){b="#FFFFFF"}if(c==undefined){c=2}this.location=a;this.size=d;this.color=b;this.thickness=c;return this}Rect.prototype.setLocation=function(a){this.location=a;if(this.canvas){this.left=this.canvas.origin.x+(this.location.x-this.size.x/2)*this.canvas.origin.x;this.top=this.canvas.origin.y-(this.location.y+this.size.y/2)*this.canvas.origin.y;this.element.style.left=this.left;this.element.style.top=this.top;if(a.z!=undefined){this.element.style.zIndex=a.z}}};Rect.prototype.setSize=function(a){this.size=a;if(this.canvas){this.left=this.canvas.origin.x+location.x*this.canvas.origin.x;this.top=this.canvas.origin.y-location.y*this.canvas.origin.y;this.image.style.left=this.left;this.image.style.top=this.top}};Rect.prototype.setStyle=function(a,b){this.color=a;this.thickness=b;if(this.element){this.element.style.border=this.thickness+"px solid "+this.color}};Rect.prototype.set=function(a,b){this.location=a;this.size=b;if(this.canvas){this.left=this.canvas.origin.x+(this.location.x-this.size.x/2)*this.canvas.origin.x;this.top=this.canvas.origin.y-(this.location.y+this.size.y/2)*this.canvas.origin.y;this.width=this.canvas.origin.x*this.size.x;this.height=this.canvas.origin.y*this.size.y;this.element.style.left=this.left;this.element.style.top=this.top;this.element.style.width=this.width;this.element.style.height=this.height}};Rect.prototype.onLoad=function(a){if(this.canvas){return}this.element=document.createElement("div");this.element.style.position="absolute";disableSelection(this.element);disableDragging(this.element);this.setStyle(this.color,this.thickness);this.canvas=a;a.element.appendChild(this.element);this.set(this.location,this.size)};Rect.prototype.onUnload=function(){if(this.canvas){this.canvas.element.removeChild(this.element);this.canvas=null}};function Text(d,a,b,e,c){if(arguments.length==0){return}if(b==undefined){b="center"}if(e==undefined){e="middle"}Element.call(this,a);this.text=d;this.hAlign=b;this.vAlign=e;this.className=c;return this}Text.prototype=new Element();Text.prototype.setText=function(b){this.text=b;if(this.canvas){while(this.element.firstChild!=null){this.element.removeChild(this.element.firstChild)}if(typeof this.text=="string"){this.element.appendChild(document.createTextNode(this.text))}else{if(isArray(this.text)){for(var a=0;a<this.text.length;a++){this.element.appendChild(document.createTextNode(this.text[a]));this.element.appendChild(document.createElement("br"))}}}this.onResize();if(this.hOffset!=0||this.vOffset!=0){this.setLocation(this.location)}}};Text.prototype.setLocation=function(a){this.location=a;if(this.canvas){this.left=(this.canvas.width/2)+a.x*(this.canvas.width/2)+this.hOffset;this.top=(this.canvas.height/2)-a.y*(this.canvas.height/2)+this.vOffset;this.element.style.left=this.left;this.element.style.top=this.top;if(a.z!=undefined){this.element.style.zIndex=a.z}}};Text.prototype.clear=function(){this.text="";if(this.canvas){while(this.element.firstChild!=null){this.element.removeChild(this.element.firstChild)}}};Text.prototype.addText=function(a){if(typeof(a)=="string"){if(typeof(this.text)=="string"){this.setText(this.text+a)}else{this.setText(this.text.concat([a]))}}else{if(typeof(this.text)=="string"){this.setText([this.text].concat(a))}else{this.setText(this.text.concat(a))}}};Text.prototype.flash=function(b,c){if(this.timeout){window.clearTimeout(this.timeout)}this.show();this.setText(b);if(c==undefined){c=1000}var a=this;this.timeout=window.setTimeout(function(){a.hide()},c)};Text.prototype.toString=function(){return"Text"};Text.prototype.onLoad=function(a){if(this.canvas){return}this.element=document.createElement("div");this.element.style.position="absolute";if(this.className){this.element.setAttribute((document.all?"className":"class"),this.className)}if(typeof this.text=="string"){this.element.appendChild(document.createTextNode(this.text))}else{if(isArray(this.text)){for(var b=0;b<this.text.length;b++){this.element.appendChild(document.createTextNode(this.text[b]));this.element.appendChild(document.createElement("br"))}}}disableSelection(this.element);disableDragging(this.element);a.element.appendChild(this.element);this.canvas=a;this.onResize();this.setLocation(this.location)};Text.prototype.onUnload=function(){if(this.canvas){this.canvas.element.removeChild(this.element);this.canvas=null}};Text.prototype.onResize=function(){if(this.hAlign=="left"){this.hOffset=0}else{if(this.hAlign=="center"){this.hOffset=-this.element.clientWidth/2}else{if(this.hAlign=="right"){this.hOffset=-this.element.clientWidth}}}if(this.vAlign=="top"){this.vOffset=0}else{if(this.vAlign=="middle"){this.vOffset=-this.element.clientHeight/2}else{if(this.vAlign=="bottom"){this.vOffset=-this.element.clientHeight}}}};function DigitalDisplay(f,c,d,g,e,b,a){if(arguments.length==0){return}if(d==undefined){d="center"}if(g==undefined){g="middle"}Element.call(this,c);this.value=f;this.hAlign=d;this.vAlign=g;this.className=e;this.precision=b;this.decimals=a;this.setValue(f);return this}DigitalDisplay.prototype=new Text();DigitalDisplay.prototype.setValue=function(a){this.value=a;if(this.decimals){this.setText(this.value.toPrecision(this.precision))}else{this.setText(this.pad(this.value.toString()))}};DigitalDisplay.prototype.toString=function(){return"DigitalDisplay"};DigitalDisplay.prototype.pad=function(a){var b=""+a;while(b.length<this.precision){b="0"+b}return b};function ItemsDisplay(k,f,a,h,c){if(c==undefined){c=0.125}this.location=k;this.value=h;this.sprites=new Array(h);var g=this.location.x-((h-1)*c/2);var e=this.location.y;var d=this.location.z;for(var b=0;b<h;b++){this.sprites[b]=new Sprite(f,new Vector3(g,e,d),a);g+=c}return this}ItemsDisplay.prototype.decrement=function(){if(this.value>0){this.value--;this.canvas.unload(this.sprites[this.value])}};ItemsDisplay.prototype.onLoad=function(a){this.canvas=a;this.canvas.load(this.sprites)};function Sound(b,a,c){if(a==undefined){a=false}if(c==undefined){c=1000}this.name=b;this.looping=a;this.duration=c;return this}Sound.prototype.play=function(){};Sound.prototype.stop=function(){};Sound.prototype.getMimeType=function(){var c="application/x-mplayer2";var b=navigator.userAgent.toLowerCase();if(navigator.mimeTypes&&b.indexOf("windows")==-1){var a=navigator.mimeTypes["audio/mpeg"].enabledPlugin;if(a){c="audio/mpeg"}}return c};Sound.prototype.onLoad=function(a){this.canvas=a};Sound.prototype.onUnload=function(){this.canvas.element.removeChild(this.element)};function GameElement(c,a,e,d,b){if(arguments[0]==null){return}if(e==undefined){e=1}if(d==undefined){d=new Vector2(0,0)}AnimatedSprite.call(this,c,a,e,d);this.size=b;return this}GameElement.prototype=new AnimatedSprite();GameElement.prototype.setLocation=function(a){AnimatedSprite.prototype.setLocation.call(this,a);if(this.border){this.border.setLocation(a)}};GameElement.prototype.getSize=function(){if(this.size){return this.size}else{return Sprite.prototype.getSize.call(this)}};GameElement.prototype.showBorder=function(a,b){if(this.border){this.border.setStyle(a,b)}else{this.border=new Rect(this.location,this.size,a,b);if(this.canvas){this.canvas.load(this.border)}}};GameElement.prototype.hideBorder=function(){if(this.canvas){this.canvas.unload(this.border);this.border=null}};GameElement.prototype.explode=function(c,b){if(!this.exploded){if(this.finish){this.finish()}this.setIcon(GameElement.explosionIcon);var a=this;this.timeout=window.setTimeout(function(){if(a.canvas){a.canvas.unload(a)}},c);this.exploded=true}};GameElement.prototype.onLoad=function(a){AnimatedSprite.prototype.onLoad.call(this,a);this.canvas.load(GameElement.explosionSound)};GameElement.prototype.onUnload=function(){if(this.border){this.canvas.unload(this.border)}AnimatedSprite.prototype.onUnload.call(this)};GameElement.explosionIcon=new Icon("images/sprites/blue_blasts.gif","center","middle",new Vector2(0,0));GameElement.explosionSound=new Sound("sounds/explosion.mp3");function Missile(b,d,a,e,c){if(b==undefined){b=new Vector2(0,0)}if(d==undefined){d=new Vector2(0,0)}if(a==undefined){a=1000}AnimatedSprite.call(this,Missile.icon,b,1,d,e,c);this.location=b;this.velocity=d;this.lifetime=a;this.onfinish=null;return this}Missile.prototype=new AnimatedSprite();Missile.prototype.update=function(a){this.velocity.y-=(a/1000)*0.1;AnimatedSprite.prototype.update.call(this,a)};Missile.prototype.start=function(a){AnimatedSprite.prototype.start.call(this,a);var b=this;this.animationInterval=window.setInterval(function(){if(b.icon==Missile.icon){b.setIcon(Missile.icon2)}else{b.setIcon(Missile.icon)}},100);this.timeout=window.setTimeout(function(){b.finish()},this.lifetime)};Missile.prototype.finish=function(){window.clearInterval(this.updateInterval);window.clearInterval(this.animationInterval);window.clearTimeout(this.timeout);if(this.canvas){this.canvas.unload(this)}if(this.onfinish){this.onfinish()}};Missile.icon=new Icon("images/spaceship/star.png","center","middle");Missile.icon2=new Icon("images/spaceship/star2.png","center","middle");function SpaceShip(a,d,c,e,b){if(d==undefined){d=1}if(c==undefined){c=new Vector2(0,0)}GameElement.call(this,SpaceShip.icon,a,d,c,new Vector2(0.35,0.35));this.thrust=0;this.maxThrust=1;this.minSpeed=0.1;this.maxSpeed=0.5;this.upDownSpeed=2;this.onfire=null;this.isShieldsUp=false;this.shieldsRotation=0;this.missiles=new Array();this.missileCount=0;this.shadowY=-0.9;this.ymin=-0.75;this.ymax=0.75;this.shieldsDuration=5000;this.animationInterval=100;this.flamesSprite=new Sprite(SpaceShip.flamesIcon,a);this.shieldsSprite=new Sprite(SpaceShip.shieldsIcon,a);this.shadowSprite=new Sprite(SpaceShip.shadowIcon,new Vector3(a.x,this.shadowY,a.z));this.fireSound=new Sound("sounds/fire.wav");this.thrustSound=new Sound("sounds/rocket.wav",true);this.explosionSound=new Sound("sounds/explosion.mp3");this.shieldsUpSound=new Sound("sounds/chime_up.wav");this.shieldsDownSound=new Sound("sounds/chime_down.wav");this.sounds=[this.fireSound,this.thrustSound,this.explosionSound,this.shieldsUpSound,this.shieldsDownSound];this.thrustKey=76;this.brakeKey=75;this.fireKey=32;this.upKey=87;this.downKey=83;this.shieldsKey=85;return this}SpaceShip.prototype=new GameElement();SpaceShip.prototype.setLocation=function(a){GameElement.prototype.setLocation.call(this,a);this.flamesSprite.setLocation(a);if(this.isShieldsUp){this.shieldsSprite.setLocation(this.location)}this.shadowSprite.setLocation(new Vector3(this.location.x,this.shadowY,this.location.z))};SpaceShip.prototype.fireMissile=function(){if(navigator.appName=="Netscape"){var g=window.innerHeight/window.innerWidth}else{var g=document.body.offsetHeight/document.body.offsetWidth}var b=this.location.plus(new Vector3(0.2,0,0));var a=2000;var f=new Vector2(0.5,this.velocity.y*0.5);var d=new Missile(b,f,a,this.hWrap,this.vWrap);var c=this;var e=this.missileCount;d.onfinish=function(){c.removeMissile(e)};this.missiles[this.missileCount]=d;this.missileCount++;this.canvas.load(d);d.start(this.intervalTime);this.fireSound.play()};SpaceShip.prototype.removeMissile=function(a){for(var b=a+1;b<this.missileCount;b++){this.missiles[b-1]=this.missiles[b]}this.missileCount--};SpaceShip.prototype.startFlames=function(b){var a=this;this.flamesAnimation=window.setInterval(function(){if(a.flamesSprite.icon==SpaceShip.flamesIcon){a.flamesSprite.setIcon(SpaceShip.flamesIcon2)}else{a.flamesSprite.setIcon(SpaceShip.flamesIcon)}},b)};SpaceShip.prototype.stopFlames=function(){window.clearInterval(this.flamesAnimation)};SpaceShip.prototype.startAnimation=function(b){var a=this;this.animation=window.setInterval(function(){if(a.icon==SpaceShip.icon){a.setIcon(SpaceShip.icon2)}else{a.setIcon(SpaceShip.icon)}},b)};SpaceShip.prototype.stopAnimation=function(){window.clearInterval(this.animation)};SpaceShip.prototype.finish=function(){this.stopFlames();this.stopAnimation()};SpaceShip.prototype.setThrust=function(a){if(this.isLoaded){if(a>0){if(this.thrust<=0){this.canvas.load(this.flamesSprite);this.startFlames(100)}}else{if(this.thrust>0){this.canvas.unload(this.flamesSprite);this.stopFlames()}}}this.thrust=a};SpaceShip.prototype.moveUp=function(){this.velocity.y=this.upDownSpeed};SpaceShip.prototype.moveDown=function(){this.velocity.y=-this.upDownSpeed};SpaceShip.prototype.flyRight=function(){this.velocity.y=0};SpaceShip.prototype.stop=function(){this.velocity.x=0;this.velocity.y=0};SpaceShip.prototype.explode=function(){if(!this.exploded){this.stopAnimation();this.setThrust(0);this.setIcon(SpaceShip.explosionIcon);this.explosionSound.play();this.disableMouse();this.disableKeyboard();this.exploded=true}};SpaceShip.prototype.reset=function(){this.startAnimation(this.animationInterval);this.setThrust(0);this.setIcon(SpaceShip.icon);this.enableMouse();this.enableKeyboard();this.exploded=false;this.isShieldsUp=false};SpaceShip.prototype.shieldsUp=function(b){if(b==undefined){b=this.shieldsDuration}this.isShieldsUp=true;this.canvas.load(this.shieldsSprite);var a=this;this.shieldsInterval=window.setInterval(function(){if(a.shieldsSprite.icon==SpaceShip.shieldsIcon){a.shieldsSprite.setIcon(SpaceShip.shieldsIcon2)}else{a.shieldsSprite.setIcon(SpaceShip.shieldsIcon)}},100);window.setTimeout(function(){a.shieldsDown()},b)};SpaceShip.prototype.shieldsDown=function(){if(this.shieldsInterval){window.clearInterval(this.shieldsInterval)}this.isShieldsUp=false;this.canvas.unload(this.shieldsSprite)};SpaceShip.prototype.update=function(b){this.intervalTime=b;var d=this.velocity.x;if(d>=this.minSpeed&&d<this.maxSpeed){this.velocity.x+=this.thrust*0.025}if(d>this.minSpeed){this.velocity.x-=d*0.005}if(this.velocity.x<this.minSpeed){this.velocity.x=this.minSpeed}else{if(this.velocity.x>this.maxSpeed){this.velocity.x=this.maxSpeed}}var a=this.location.plus(this.velocity.scaledBy(b/1000).toVector3());if(a.y<this.ymin){a.y=this.ymin;this.velocity.y=0}else{if(a.y>this.ymax){a.y=this.ymax;this.velocity.y=0}}this.setLocation(a);for(var c=0;c<this.missileCount;c++){this.missiles[c].update(b)}};SpaceShip.prototype.enableMouse=function(b){if(b==undefined){b=document}var a=this;this.mouseMoveListener=$(b).mousemove(function(d){var c=a.canvas.toScreenCoords(new Vector2(d.pageX-a.canvas.left,d.pageY-a.canvas.top));var e=-0.5;if(c.x-e>0){a.setThrust(a.maxThrust*(c.x-e))}else{if(c.x-e<-0.1&&a.velocity.x>0){a.setThrust(a.maxThrust*(c.x-e))}else{a.setThrust(0)}}if(Math.abs(c.y)>0.1){a.velocity.y=a.upDownSpeed*c.y}else{a.velocity.y=0}});this.mouseDownListener=$(b).click(function(c){a.fireMissile()})};SpaceShip.prototype.enableKeyboard=function(b){if(b==undefined){b=document}var a=this;this.keyPressListener=$(b).keypress(function(c){a.fireMissile()})};SpaceShip.prototype.disableMouse=function(a){if(a==undefined){a=document}$(a).unbind("mousemove");$(a).unbind("click")};SpaceShip.prototype.disableKeyboard=function(a){if(a==undefined){a=document}$(a).unbind("keypress")};SpaceShip.prototype.onLoad=function(a){GameElement.prototype.onLoad.call(this,a);a.load(this.shadowSprite);a.load(this.sounds);this.enableMouse();this.enableKeyboard();this.startAnimation(this.animationInterval)};SpaceShip.prototype.onUnload=function(){this.finish();this.canvas.unload(this.shadowSprite);this.canvas.unload(this.sounds);this.disableMouse();this.disableKeyboard();GameElement.prototype.onUnload.call(this,canvas)};SpaceShip.icon=new Icon("images/spaceship/scott-walker-flying1.png","center","middle",new Vector2(7,15));SpaceShip.icon2=new Icon("images/spaceship/scott-walker-flying2.png","center","middle",new Vector2(7,15));SpaceShip.flamesIcon=new Icon("images/spaceship/flames1.png","right","middle",new Vector2(90,0));SpaceShip.flamesIcon2=new Icon("images/spaceship/flames2.png","right","middle",new Vector2(90,0));SpaceShip.shieldsIcon=new Icon("images/spaceship/shields.png","center","middle",new Vector2(15,0));SpaceShip.shieldsIcon2=new Icon("images/spaceship/shields2.png","center","middle",new Vector2(15,0));SpaceShip.shadowIcon=new Icon("images/spaceship/shadow.png","center","middle",new Vector2(0,0));SpaceShip.explosionIcon=new Icon("images/sprites/red_blasts.gif","center","middle",new Vector2(0,0));function ScrollingBackground(d,c,e,g,a,f){if(e==undefined){e=0}if(g!="top"&&g!="bottom"){g="top"}if(a==undefined){a=""}if(f==undefined){f=0}this.length=d;this.imageNames=c;this.offset=e;this.vAlign=g;this.zIndex=f;this.images=new Array(c.length);for(var b=0;b<c.length;b++){this.images[b]=new Image();if(a){this.images[b].src=a+c[b]}else{this.images[b].src=c[b]}}return this}ScrollingBackground.prototype.addOffset=function(c){this.offset+=c;this.xmin=-1+c;this.xmax=1+c;var a=Math.floor(this.offset%this.images.length);if(c>0&&a!=this.leftIndex&&this.leftIndex!=undefined){if(this.leftImage){this.leftImage.parentNode.removeChild(this.leftImage);this.leftImage.loaded=false}}this.leftIndex=a;this.leftImage=this.images[this.leftIndex];if(this.leftImage){this.leftImage.left=-Math.floor((this.offset-Math.floor(this.offset))*this.canvas.width);this.leftImage.style.left=this.leftImage.left;this.leftImage.style.zIndex=this.zIndex}if(this.leftImage&&!this.leftImage.loaded){this.canvas.element.appendChild(this.leftImage);this.leftImage.loaded=true}var b=Math.floor((this.offset+1)%this.images.length);if(c<0&&b!=this.rightIndex&&this.rightIndex!=undefined){if(this.rightImage){this.rightImage.parentNode.removeChild(this.rightImage);this.rightImage.loaded=false}}this.rightIndex=b;this.rightImage=this.images[this.rightIndex];if(this.rightImage){this.rightImage.left=-Math.floor((this.offset-Math.floor(this.offset+1))*this.canvas.width);this.rightImage.style.left=this.rightImage.left;this.rightImage.style.zIndex=this.zIndex}if(this.rightImage&&!this.rightImage.loaded){this.canvas.element.appendChild(this.rightImage);this.rightImage.loaded=true}};ScrollingBackground.prototype.onLoad=function(a){this.canvas=a;for(var b=0;b<this.images.length;b++){var c=this.images[b];c.style.position="absolute";disableSelection(c);disableDragging(c);c.width=a.width;if(this.vAlign=="top"){c.top=0;c.left=0;c.style.top=c.top+"px";c.style.left=c.left+"px"}else{if(this.vAlign=="bottom"){c.top=a.height-c.height;c.left=0;c.style.top=c.top+"px";c.style.left=c.left+"px"}}}this.addOffset(0)};ScrollingBackground.prototype.onUnload=function(){for(i=0;i<this.images.length;i++){this.canvas.removeChild(this.images[i])}this.images=null;this.canvas=null};function GameLevel(c,d,a,b){if(b==undefined){b=-0.6}this.length=c;this.elements=d;if(d){this.numElements=d.length}this.player=a;this.xOffset=b;this.offset=0;if(this.elements){this.elements.sort(function(f,e){return f.location.x-e.location.x})}return this}GameLevel.prototype.addOffset=function(c){this.offset+=c;for(var b=0;b<this.numElements;b++){if(this.elements[b]){var a=this.elements[b].location.x-c*2;if(a>-1){if(this.elements[b].loaded){this.elements[b].setLocation(new Vector3(a,this.elements[b].location.y,this.elements[b].location.z))}else{this.elements[b].location.x=a;if(a<1){this.canvas.load(this.elements[b])}}}else{if(!this.elements[b].exploded&&this.onmiss){this.onmiss(this.elements[b])}this.removeElement(this.elements[b])}}}};GameLevel.prototype.getIndex=function(b){for(var a=0;a<this.elements.length;a++){if(b==this.elements[a]){return a}}};GameLevel.prototype.removeElement=function(c){var a=this.getIndex(c);this.elements[a].finish();this.canvas.unload(this.elements[a]);var c=this.elements[a];for(var b=a+1;b<this.numElements;b++){this.elements[b-1]=this.elements[b]}this.numElements--;if(this.onremove){this.onremove(c)}};GameLevel.prototype.collide=function(a){this.crashLocation=this.player.location.clone();this.crashOffset=this.player.offset;if(a.collide){a.collide(3000,this.oncollide)}if(this.oncollide){this.oncollide(a)}};GameLevel.prototype.update=function(b){this.player.update(b);if(this.offset<this.length-1&&!this.player.exploded){this.player.offset=this.xOffset+(this.player.velocity.x-this.player.minSpeed)/4;var d=-(this.player.offset-this.player.location.x);this.addOffset(d);this.player.setLocation(new Vector3(this.player.offset,this.player.location.y,this.player.location.z))}else{if(this.player.location.x>1.25&&!this.player.exploded){window.clearInterval(this.interval);if(this.onfinish){this.onfinish()}}}var a=this.player.getExtents();if(!this.player.isShieldsUp&&!this.player.exploded){for(var f=0;f<this.numElements;f++){var g=this.elements[f];var h=g.getExtents();if(h&&a.overlaps(h)&&!g.exploded){if(g instanceof Money){this.player.shieldsUp();g.take(3000);this.removeElement(g)}else{if(this.player.location.x<1){this.player.explode();this.collide(g);return}}}}}for(var f=0;f<this.numElements;f++){var g=this.elements[f];if(g.location.x<1&&!g.exploded){var h=g.getExtents();if(h){for(var e=0;e<this.player.missileCount;e++){var c=this.player.missiles[e];if(h.contains(c.location.toVector2())){c.finish();var k=this;g.explode(3000,function(){k.removeElement(g)});if(this.onhit){this.onhit(g)}}}}}}};GameLevel.prototype.start=function(a){this.intervalTime=a;for(var c=0;c<this.elements.length;c++){if(this.elements[c].start){this.elements[c].start(a)}}var b=this;this.interval=window.setInterval(function(){b.update(b.intervalTime)},a);this.player.setLocation(new Vector3(this.xOffset,0,this.player.location.z));this.player.velocity=new Vector2(this.player.minSpeed,0);this.player.hWrap=false};GameLevel.prototype.onLoad=function(a){this.canvas=a};GameLevel.prototype.onUnload=function(){this.canvas.unload(this.elements);this.canvas=null};function Worker(a,e,c,d,b,f){if(a==undefined){a=new Vector2(0,0)}if(e==undefined){e=1}if(c==undefined){c=new Vector2(0,0)}GameElement.call(this,Worker.icon,a,e,c,new Vector2(0.25,0.25));this.title=d;this.salary=b;this.messageDisplay=f;this.vBounce=true;return this}Worker.prototype=new GameElement();Worker.prototype.start=function(a){GameElement.prototype.start.call(this,a);var b=this;this.interval=window.setInterval(function(){if(b.icon==Worker.icon){b.setIcon(Worker.icon2)}else{b.setIcon(Worker.icon)}},75)};Worker.prototype.finish=function(){if(this.interval){window.clearTimeout(this.interval)}};Worker.prototype.explode=function(a,b){GameElement.prototype.explode.call(this,1000,b);this.messageDisplay.flash(["You just swatted  "+this.title,"earning "+Money.prototype.dollarsToString(this.salary)+" per year."],a)};Worker.prototype.collide=function(b,a){this.messageDisplay.flash(["You just got stung by "+this.title,"earning "+Money.prototype.dollarsToString(this.salary)+" per year."],b)};Worker.prototype.onLoad=function(a){GameElement.prototype.onLoad.call(this,a)};Worker.prototype.onUnload=function(){if(!this.canvas){return}GameElement.prototype.onUnload.call(this)};Worker.icon=new Icon("images/bee/bee.png","center","middle",new Vector2(0,0));Worker.icon2=new Icon("images/bee/bee2.png","center","middle",new Vector2(0,0));function Money(b,g,f,e,a,d,h,c){if(b==undefined){b=new Vector3(0,0,0)}if(g==undefined){g=1}if(f==undefined){f=new Vector2(0,0)}GameElement.call(this,Money.icon,b,g,f);this.amount=e;this.donor=a;this.logoIcon=d;this.messageDisplay=h;this.imageDisplay=c;return this}Money.prototype=new GameElement();Money.prototype.pad=function(a,b){var c=""+a;while(c.length<b){c="0"+c}return c};Money.prototype.dollarsToString=function(c){var a="$";if(c>1000){var b=Math.floor(c/1000);a+=b;a+=",";a+=this.pad(c-b*1000,3)}else{a+=c}return a};Money.prototype.take=function(b){this.messageDisplay.flash(["You just took "+this.dollarsToString(this.amount),"from "+this.donor+"."],b);this.imageDisplay.setIcon(this.logoIcon);if(!imageDisplay.canvas){this.canvas.load(this.imageDisplay)}this.imageDisplay.showBorder("black",2);var a=this;window.setTimeout(function(){if(a.imageDisplay.icon==a.logoIcon){if(a.imageDisplay.canvas){a.imageDisplay.canvas.unload(a.imageDisplay)}}},b)};Money.icon=new Icon("images/sprites/money.png","center","middle",new Vector2(0,0));function WorkerGameLevel(b,m,r,h,c,p,d){if(b){var k=1;var l=b*2-1}this.workers=new Array(r.length);for(var n=0;n<r.length;n++){var a=new Vector3(random(k,l),random(m.ymin,m.ymax),5);var s=1;var f=new Vector2(-0.1,random(-0.5,0.5));var t=r[n][0];var q=r[n][1];this.workers[n]=new Worker(a,s,f,t,q,c)}this.money=new Array(h.length);for(var n=0;n<h.length;n++){var a=new Vector3(random(k,l),random(m.ymin,m.ymax),6);var s=1;var f=new Vector2(0,0);var g=h[n][0];var e=h[n][1];var o=new Icon(h[n][2]);this.money[n]=new Money(a,s,f,e,g,o,c,p)}GameLevel.call(this,b,this.workers.concat(this.money),m);this.messageDisplay=c;this.imageDisplay=p;this.livesDisplay=d;this.background=new ScrollingBackground(b,["farmland.png","farmland.png"],0,"bottom","images/backgrounds/",1);this.nearBackground=new ScrollingBackground(2,["fields.png","fields.png"],0,"bottom","images/backgrounds/",2);this.farBackground=new ScrollingBackground(2,["horizon.png","horizon.png"],0,"bottom","images/backgrounds/",0);this.skyBackground=new ScrollingBackground(2,["clouds.png","clouds.png"],0,"top","images/backgrounds/",0);return this}WorkerGameLevel.prototype=new GameLevel();WorkerGameLevel.prototype.addOffset=function(a){GameLevel.prototype.addOffset.call(this,a);this.background.addOffset(a);this.nearBackground.addOffset(a*1.5);this.farBackground.addOffset(a*0.5);this.skyBackground.addOffset(a*0.1)};WorkerGameLevel.prototype.collide=function(b){GameLevel.prototype.collide.call(this,b);var a=this;window.setTimeout(function(){a.livesDisplay.decrement()},2000)};WorkerGameLevel.prototype.onLoad=function(a){GameLevel.prototype.onLoad.call(this,a);a.load(this.background);a.load(this.nearBackground);a.load(this.farBackground);a.load(this.skyBackground)};